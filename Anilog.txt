<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>AniLog - Firebase</title>
<style>
body { font-family: 'Pretendard', sans-serif; background-color: #f0f0ff; margin:0; padding:0; }
header { background-color: #7b68ee; color: white; text-align: center; padding:20px 0; font-size:1.5em; font-weight:bold; box-shadow:0 3px 6px rgba(0,0,0,0.15);}
main { padding:15px; max-width:600px; margin:auto; }
input, select, textarea, button { width:100%; padding:10px; margin:6px 0; border-radius:6px; font-size:1em; box-sizing:border-box; }
button { border:none; color:white; cursor:pointer; font-weight:bold; }
button:hover { opacity:0.9; }
.add-form, #loginForm { background:#fff; border-radius:12px; padding:15px; box-shadow:0 3px 10px rgba(0,0,0,0.1); margin-bottom:25px; }
.star-container { font-size:2em; color:#ccc; display:flex; gap:0; margin:10px 0;}
.star { position:relative; display:inline-block; width:1.5em; cursor:pointer; }
.star::before { content:"â˜…"; color:#ccc; position:absolute; left:0; top:0; }
.star.full::before { color:gold; }
.star.half::before { background: linear-gradient(90deg, gold 50%, #ccc 50%); -webkit-background-clip:text; -webkit-text-fill-color:transparent; color:gold; }
.anime-card { background:#fff; border-radius:12px; padding:15px; margin-bottom:20px; box-shadow:0 4px 12px rgba(0,0,0,0.12);}
.anime-header { display:flex; justify-content:space-between; align-items:center; }
.anime-title { font-size:1.2em; font-weight:bold; color:#5a43cb; cursor:pointer; }
.delete-btn, .edit-btn, #logoutBtn { background:#ff5c5c; color:white; border:none; border-radius:6px; padding:4px 8px; cursor:pointer; font-size:0.85em; margin-left:5px; }
.edit-btn { background:#5c9cff; }
.review { background-color:#f1efff; padding:10px; border-radius:8px; font-size:0.95em; color:#444; margin-top:10px; }
</style>
</head>
<body>

<header>ğŸ¬ AniLog</header>

<main>
<div id="loginForm" class="add-form">
  <h3>ë¡œê·¸ì¸ / íšŒì›ê°€ì…</h3>
  <input type="email" id="email" placeholder="ì´ë©”ì¼">
  <input type="password" id="password" placeholder="ë¹„ë°€ë²ˆí˜¸">
  <button onclick="login()">ë¡œê·¸ì¸</button>
  <button onclick="signup()" style="background:#5c9cff;">íšŒì›ê°€ì…</button>
</div>

<div id="app" style="display:none;">
  <button id="logoutBtn" onclick="logout()" style="margin-bottom:10px;">ë¡œê·¸ì•„ì›ƒ</button>
  <div class="add-form">
    <h3 id="formTitle">ï¼‹ ìƒˆ ì• ë‹ˆ ì¶”ê°€</h3>
    <input id="title" type="text" placeholder="ì• ë‹ˆ ì œëª©">
    <select id="status" onchange="statusChanged()">
      <option value="ì™„ë£Œ">ì™„ë£Œ</option>
      <option value="ì‹œì²­ ì¤‘">ì‹œì²­ ì¤‘</option>
    </select>
    <div id="starWrapper">
      <label>ë³„ì  (0.5 ë‹¨ìœ„)</label>
      <div class="star-container" id="starInput"></div>
    </div>
    <div style="margin-top:50px;">
      <textarea id="review" rows="3" placeholder="ê°ìƒí‰ì„ ì…ë ¥í•˜ì„¸ìš”"></textarea>
    </div>
    <label>ì‹œì²­ ì‹œì‘ ë‚ ì§œ</label>
    <input id="startDate" type="date">
    <label id="endDateLabel">ì™„ë£Œ ë‚ ì§œ</label>
    <input id="endDate" type="date">
    <button id="submitBtn" onclick="addOrUpdateAnime()">ì¶”ê°€í•˜ê¸°</button>
  </div>

  <ul id="animeList"></ul>
</div>

<!-- Firebase SDK -->
<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore-compat.js"></script>

<script>
const firebaseConfig = {
  apiKey: "YOUR_API_KEY",
  authDomain: "YOUR_PROJECT_ID.firebaseapp.com",
  projectId: "YOUR_PROJECT_ID",
  storageBucket: "YOUR_PROJECT_ID.appspot.com",
  messagingSenderId: "YOUR_SENDER_ID",
  appId: "YOUR_APP_ID"
};
firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();
const db = firebase.firestore();

// ì˜¤ëŠ˜ ë‚ ì§œ
const today = new Date().toISOString().split('T')[0];
const startInput = document.getElementById('startDate');
const endInput = document.getElementById('endDate');
startInput.setAttribute('max', today);
endInput.setAttribute('max', today);

let selectedRating = 0;
let editId = null;

// ë³„ì  ì…ë ¥
const starInput = document.getElementById('starInput');
function renderStarInput(rating){
  starInput.innerHTML='';
  for(let i=1;i<=5;i++){
    const star=document.createElement('span');
    star.classList.add('star');
    star.dataset.value=i;
    if(rating>=i){ star.classList.add('full'); }
    else if(rating>=i-0.5){ star.classList.add('half'); }
    starInput.appendChild(star);
  }
}
function getStarValueFromEvent(e){
  const rect = e.target.getBoundingClientRect();
  const x = e.clientX - rect.left;
  return parseInt(e.target.dataset.value) - (x < rect.width/2 ? 0.5 : 0);
}
starInput.addEventListener('mousemove', e=>{
  if(e.target.classList.contains('star')) renderStarInput(getStarValueFromEvent(e));
});
starInput.addEventListener('mouseleave', ()=>renderStarInput(selectedRating));
starInput.addEventListener('click', e=>{
  if(e.target.classList.contains('star')){
    selectedRating = getStarValueFromEvent(e);
    renderStarInput(selectedRating);
  }
});

// ë¡œê·¸ì¸/íšŒì›ê°€ì…
function signup(){
  const email=document.getElementById('email').value;
  const password=document.getElementById('password').value;
  auth.createUserWithEmailAndPassword(email,password).then(()=>alert('íšŒì›ê°€ì… ì™„ë£Œ')).catch(e=>alert(e.message));
}
function login(){
  const email=document.getElementById('email').value;
  const password=document.getElementById('password').value;
  auth.signInWithEmailAndPassword(email,password).catch(e=>alert(e.message));
}
function logout(){ auth.signOut(); }

// ì‚¬ìš©ì ìƒíƒœ ê°ì§€
auth.onAuthStateChanged(user=>{
  if(user){
    document.getElementById('loginForm').style.display='none';
    document.getElementById('app').style.display='block';
    loadAnime();
  } else {
    document.getElementById('loginForm').style.display='block';
    document.getElementById('app').style.display='none';
  }
});

// Firestoreì— ì¶”ê°€/ìˆ˜ì •
function addOrUpdateAnime(){
  const title=document.getElementById('title').value.trim();
  const status=document.getElementById('status').value;
  const review=document.getElementById('review').value.trim();
  const startDate=startInput.value;
  let endDate=endInput.value;
  if(!title){ alert('ì• ë‹ˆ ì œëª©ì„ ì…ë ¥í•˜ì„¸ìš”!'); return; }
  if(status==='ì™„ë£Œ' && selectedRating<=0){ alert('ë³„ì ì„ ì„ íƒí•´ì£¼ì„¸ìš”'); return; }
  if(status==='ì™„ë£Œ' && !endDate) endDate=today;
  if(status==='ì‹œì²­ ì¤‘') endDate='';

  const data={title,status,rating:selectedRating,review,startDate,endDate,uid:auth.currentUser.uid};

  if(editId){
    db.collection('anime').doc(editId).set(data).then(()=>{ resetForm(); editId=null; loadAnime(); });
  } else {
    db.collection('anime').add(data).then(()=>resetForm());
  }
}

// ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸° (ì‚¬ìš©ìë³„)
function loadAnime(){
  const list = document.getElementById('animeList');
  list.innerHTML='';
  db.collection('anime').where('uid','==',auth.currentUser.uid).onSnapshot(snapshot=>{
    list.innerHTML='';
    snapshot.forEach(doc=>{
      const anime = doc.data();
      const li=document.createElement('li');
      li.className='anime-card';
      li.innerHTML=`
        <div class="anime-header">
          <div class="anime-title">${anime.title}</div>
          <div>
            <button class="edit-btn" onclick="editAnime('${doc.id}')">ìˆ˜ì •</button>
            <button class="delete-btn" onclick="deleteAnime('${doc.id}')">ì‚­ì œ</button>
          </div>
        </div>
        <div>ğŸ“… ${anime.status} | ë³„ì : ${anime.rating}</div>
        <div>ì‹œì‘: ${anime.startDate||'-'} | ì™„ë£Œ: ${anime.endDate||'-'}</div>
        <div class="review">${anime.review}</div>
      `;
      list.appendChild(li);
    });
  });
}

// ì‚­ì œ
function deleteAnime(id){ if(confirm('ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) db.collection('anime').doc(id).delete(); }

// ìˆ˜ì •
function editAnime(id){
  db.collection('anime').doc(id).get().then(doc=>{
    const a=doc.data();
    editId=id;
    document.getElementById('title').value=a.title;
    document.getElementById('status').value=a.status;
    statusChanged();
    selectedRating=a.rating;
    renderStarInput(selectedRating);
    document.getElementById('review').value=a.review;
    startInput.value=a.startDate;
    endInput.value=a.endDate;
    document.getElementById('submitBtn').innerText='ìˆ˜ì • ì™„ë£Œ';
    document.getElementById('formTitle').innerText='âœ ì• ë‹ˆ ìˆ˜ì •';
  });
}

// ìƒíƒœ ë³€ê²½ ì‹œ ë³„ì /ì™„ë£Œë‚ ì§œ ì²˜ë¦¬
function statusChanged(){
  const status=document.getElementById('status').value;
  if(status==='ì‹œì²­ ì¤‘'){
    document.getElementById('starWrapper').style.display='none';
    endInput.style.display='none';
    document.getElementById('endDateLabel').style.display='none';
  } else {
    document.getElementById('starWrapper').style.display='block';
    endInput.style.display='block';
    document.getElementById('endDateLabel').style.display='block';
  }
}

// í¼ ì´ˆê¸°í™”
function resetForm(){
  document.getElementById('title').value='';
  document.getElementById('status').value='ì™„ë£Œ';
  statusChanged();
  selectedRating=0; renderStarInput(selectedRating);
  document.getElementById('review').value='';
  startInput.value='';
  endInput.value='';
  document.getElementById('submitBtn').innerText='ì¶”ê°€í•˜ê¸°';
  document.getElementById('formTitle').innerText='ï¼‹ ìƒˆ ì• ë‹ˆ ì¶”ê°€';
}
</script>
</body>
</html>
